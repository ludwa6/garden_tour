<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QR Admin</title>

  <script>
    // Compute basePath for localhost vs GitHub Pages
    const repoRoot = window.location.pathname.split("/")[1];
    window.basePath = repoRoot && window.location.hostname.includes("github.io")
      ? `/${repoRoot}/`
      : "/";

    // Dynamically inject stylesheet with correct path
    const cssLink = document.createElement("link");
    cssLink.rel = "stylesheet";
    cssLink.href = new URL("style.css?v=2", window.location.origin + window.basePath).href;
    document.head.appendChild(cssLink);
  </script>
</head>
<body class="qr-admin-page">
  <div class="appbar">
    <h1>QR Admin</h1>
    <a href="./index.html" class="back-btn">‚Üê Back to main</a>
  </div>

  <main id="qr-admin-content">
    <!-- Controls -->
    <div class="controls">
      <label for="observationSelect">Select Observation:</label>
      <select id="observationSelect">
        <option value="">Loading...</option>
      </select>
    </div>

    <!-- QR code preview -->
    <div id="qr-preview">
      <h3>Custom QR Code:</h3>
      <canvas id="qrCanvas"></canvas>
    </div>
    
    <!-- Observation preview -->
    <div id="observationPreview" class="preview"></div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script>
    // Load qr_admin.js relative to basePath
    const script = document.createElement("script");
    script.src = new URL("qr_admin.js", window.location.origin + window.basePath).href;
    document.body.appendChild(script);
  </script>

  <footer id="site-footer"></footer>

  <script>
    // Inject shared footer.html into this page
    const footerPath = new URL("footer.html", window.location.origin + window.basePath).href;
    fetch(footerPath)
      .then(res => res.text())
      .then(html => {
        document.getElementById("site-footer").innerHTML = html;

        // Fix link paths based on environment
        document.querySelectorAll("#site-footer .nav-link").forEach(link => {
          link.href = window.basePath + link.dataset.target;
        });
      })
      .catch(err => console.error("Failed to load footer:", err));
  </script>
</body>
</html>
